local Talents = require("engine.interface.ActorTalents")
local Chat = require"engine.Chat"
load("/data/general/traps/store.lua")

newEntity{ define_as = "KAM_WOVENHOME_PROF_HUNDREDEYES",
	type = "undead", subtype = "lich",
	display = "h",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/undead_lich_ancient_lich.png", display_h=2, display_y=-1}}},
	faction = "spellweavers",
	name = "Professor Hundredeyes", color=colors.PURPLE, unique = true,
desc = ([[The near legendary Head Professor of Necromancy and Applied Informational Advantages, a hundred year-old lich. Respected and feared for her arcane eyes, she's said to see everything that happens in Wovenhome (and most of the rest of Var'Eyal if some rumors are to be believed).
Additionally, they discovered the Spellwoven method of working with necromancy and creating method of performing lich transformations with careful Spellweave magic instead of blood sacrifices.]]):tformat(),
	level_range = {50, nil}, exp_worth = 2,
	rank = 4,
	size_category = 3,
	mana_regen = 10,
	max_mana = 2000,
	max_life = 350, life_rating = 20, fixed_rating = true,
	infravision = 10,
	stats = { str=10, dex=10, cun=30, mag=80, con=14, wil=60 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	anger_emote = _t"Don't even try it.",
	hates_antimagic = 0,

	open_door = true,

	resolvers.inscriptions(3, "rune"),
	resolvers.inscriptions(1, {"manasurge rune"}),

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", subtype="staff", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", subtype="cloth", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE]=10,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_STRENGTHEN]=10,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_SUSTAIN]=10,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_MASTERY]=10,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN]=10,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_STRENGTHEN]=10,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_SUSTAIN]=10,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_MASTERY]=10,
		[Talents.T_KAM_ELEMENTS_RUIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_GRAVECHILL]=6,
		[Talents.T_KAM_ELEMENTS_GRAVITY]=3,
		[Talents.T_KAM_ELEMENTS_FEVER]=3,
		[Talents.T_KAM_ELEMENTS_MANASTORM]=3,
		[Talents.T_KAM_ELEMENTS_CORRODING_BRILLIANCE]=3,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=5,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=5,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=3,
		[Talents.T_KAM_SPELLWOVEN_MASTERY]=5,
		[Talents.T_KAM_SPELLWOVEN_PERFECTION]=5,
		[Talents.T_KAM_SPELLWOVEN_DESTRUCTION]=5,
		[Talents.T_KAM_SPELLWEAVER_MASTER]=3,
		[Talents.T_ARCANE_EYE]=15,
		[Talents.T_KEEN_SENSES]=5,
		[Talents.T_VISION]=5,
		[Talents.T_PREMONITION]=5,
		[Talents.T_KAM_ARCANE_VISIONS_EYETRACKING]=10,
		[Talents.T_KAM_ARCANE_VISIONS_VISION_CASTING]=10,
		[Talents.T_KAM_ARCANE_VISIONS_WATCHFUL_EYES]=15,
		[Talents.T_KAM_ARCANE_VISIONS_HUNDREDEYES]=10,
--		[Talents.T_LICH]=1, -- Causes the player to get the Becoming a Lich message.
		[Talents.T_NEVERENDING_UNLIFE]=5,
		[Talents.T_FRIGHTENING_PRESENCE]=5,
		[Talents.T_COMMANDER_OF_THE_DEAD]=5, -- No Doomed For Eternity, it doesn't fit the theme.
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_DURATION]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_SPEED]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_MASTERY]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=5,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=5,
	},

	can_talk = "kam-spellweaver-professor-hundredeyes",
}

newEntity{ define_as = "KAM_WOVENHOME_PROF_IFNAI",
	type = "humanoid", subtype = "elf",
	display = "i",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/humanoid_human_alchemist.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Professor Ifnai", color=colors.BROWN, unique = true,
desc = ([[The ever-eccentric Professor of History, Arcane Recording, and Spellweaving Theory. Xe serves as the main record keeper, keeping notes on most every lecture ever given by any Spellweaver, and has been doing so nearly since the beginning of Wovenhome. Xe is also known to sell copies of records to students interested in Spellwoven history or Theory.
Xe does not emphasize a strong elemental style as a Spellweaver, preferring to take advantage of xir historical knowledge of fighting techniques to analyze foes and then defeat them with xir ever-changing tactics.]]):tformat(),
	level_range = {50, nil}, exp_worth = 2,
	rank = 4,
	size_category = 3,
	mana_regen = 10,
	max_mana = 1600,
	max_life = 320, life_rating = 20, fixed_rating = true,
	infravision = 10,
	stats = { str=8, dex=8, cun=60, mag=55, con=10, wil=55 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	anger_emote = _t"I've already got a plan for this.",
	hates_antimagic = 0,

	open_door = true,

	resolvers.inscriptions(3, "rune"),
	resolvers.inscriptions(1, {"manasurge rune"}),

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", subtype="staff", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", subtype="cloth", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_RUIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_GRAVECHILL]=3,
		[Talents.T_KAM_ELEMENTS_GRAVITY]=3,
		[Talents.T_KAM_ELEMENTS_FEVER]=3,
		[Talents.T_KAM_ELEMENTS_MANASTORM]=3,
		[Talents.T_KAM_ELEMENTS_CORRODING_BRILLIANCE]=3,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=5,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=5,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=3,
		[Talents.T_KAM_SPELLWOVEN_MASTERY]=5,
		[Talents.T_KAM_SPELLWOVEN_PERFECTION]=5,
		[Talents.T_KAM_SPELLWOVEN_DESTRUCTION]=5,
		[Talents.T_KAM_SPELLWEAVER_MASTER]=3,
		[Talents.T_KAM_HISTORICAL_ADVANTAGE_HISTORICAL_ADVANTAGE]=1,
		[Talents.T_KAM_HISTORICAL_ADVANTAGE_HISTORICAL_EDGE]=5,
		[Talents.T_KAM_HISTORICAL_ADVANTAGE_HISTORICAL_TECHNIQUE]=5,
		[Talents.T_KAM_HISTORICAL_ADVANTAGE_NEW_HISTORY]=5,
		[Talents.T_KAM_METAWEAVING_CRAFT]=1,
		[Talents.T_KAM_METAWEAVING_THREADSWITCH]=5,
		[Talents.T_KAM_METAWEAVING_EMPOWERMENT]=5,
		[Talents.T_KAM_METAWEAVING_SANCTUARY]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_DURATION]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_SPEED]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_MASTERY]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=5,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=5,
	},
	can_talk = "kam-spellweaver-professor-ifnai",
	store = game:getStore("KAM_WOVENHOME_IFNAI_LORE")
}

newEntity{ define_as = "KAM_WOVENHOME_PROF_PARADISE",
	type = "elemental", subtype = "harmonic",
	display = "p",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/elemental_temporal_telugoroth.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Professor Paradise", color=colors.RED, unique = true,
desc = ([[Professor Paradise, an elemental construct created by the Spellweavers who originally created Wovenhome, and the one who maintains the Spellwoven Harmony that protects Wovenhome from invasions (or more likely, Spellweavers accidentally exploding it).
Also the Professor of Elementalism and Magical Synergistics, although since they only communicate through old elemental runes, most of their classes need a translator.]]):tformat(),
	level_range = {50, nil}, exp_worth = 2,
	rank = 4,
	size_category = 2,
	mana_regen = 100,
	max_mana = 3000,
	max_life = 350, life_rating = 18, fixed_rating = true,
	infravision = 10,
	stats = { str=10, dex=10, cun=30, mag=90, con=10, wil=70 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	anger_emote = _t"(Runes glow in the air with a terrifying glow, but you cannot read them)",
	hates_antimagic = 0,

	open_door = true,

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="jewelry", subtype="amulet", ego_chance=100, forbid_power_source={antimagic=true}, autoreq=true},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_RUIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_GRAVECHILL]=3,
		[Talents.T_KAM_ELEMENTS_GRAVITY]=3,
		[Talents.T_KAM_ELEMENTS_FEVER]=3,
		[Talents.T_KAM_ELEMENTS_MANASTORM]=3,
		[Talents.T_KAM_ELEMENTS_CORRODING_BRILLIANCE]=3,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=5,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=5,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=3,
		[Talents.T_KAM_SPELLWOVEN_MASTERY]=5,
		[Talents.T_KAM_SPELLWOVEN_PERFECTION]=5,
		[Talents.T_KAM_SPELLWOVEN_DESTRUCTION]=5,
		[Talents.T_KAM_SPELLWEAVER_MASTER]=3,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_DURATION]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_SPEED]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_MASTERY]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=5,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=5,
		[Talents.T_KAM_ELEMENTAL_HARMONY_ELEMENTAL_SOUL]=10,
		[Talents.T_KAM_ELEMENTAL_HARMONY_ELEMENTAL_OVERPOWER]=10,
		[Talents.T_KAM_ELEMENTAL_HARMONY_ELEMENTAL_ASCENDANCE]=10,
		[Talents.T_KAM_ELEMENTAL_HARMONY_ELEMENTAL_PURIFICATION]=10,
	},

	can_talk = "kam-spellweaver-professor-paradise",
}

newEntity{ define_as = "KAM_WOVENHOME_PROF_ARBUS",
	type = "animal", subtype = "canine",
	display = "a",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/canine_fox.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Professor Arbus", color=colors.GREEN, unique = true,
desc = ([[Possibly the strangest of the Spellweaving teachers, Professor Arbus is a talking fox and the Professor of Natural Spellweaving and Self-Applied Spellweaving. Students still debate whether they were always a fox and are just weirdly intelligent or if they transformed themself into a fox with some kind of advanced Spellweaving technique. Typically when asked, they just get distracted by complaining about snakes with guns, so...
As a Spellweaver, they've studied Natural Spellweaving as well as Enchanting and self-Enchanting Spellweaving techniques.]]):tformat(),
	level_range = {50, nil}, exp_worth = 2,
	rank = 4,
	size_category = 2,
	mana_regen = 20,
	max_mana = 1000,
	equilibrium = 0,
	max_life = 350, life_rating = 20, fixed_rating = true,
	infravision = 10,
	stats = { str=15, dex=30, cun=40, mag=50, con=20, wil=60 },
	instakill_immune = 1,
	teleport_immune = 1,
	silence_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	hates_antimagic = 0,

	open_door = true,

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{ 
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_RUIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=5,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=5,
		[Talents.T_KAM_ELEMENTS_GRAVECHILL]=3,
		[Talents.T_KAM_ELEMENTS_GRAVITY]=3,
		[Talents.T_KAM_ELEMENTS_FEVER]=3,
		[Talents.T_KAM_ELEMENTS_MANASTORM]=3,
		[Talents.T_KAM_ELEMENTS_CORRODING_BRILLIANCE]=3,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=5,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=5,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=3,
		[Talents.T_KAM_SPELLWOVEN_MASTERY]=5,
		[Talents.T_KAM_SPELLWOVEN_PERFECTION]=5,
		[Talents.T_KAM_SPELLWOVEN_DESTRUCTION]=5,
		[Talents.T_KAM_SPELLWEAVER_MASTER]=3,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_DURATION]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_SPEED]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_MASTERY]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=7,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=7,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=7,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=7,
		[Talents.T_KAM_NATURAL_SPELLWEAVING_CORE]=6,
		[Talents.T_KAM_NATURAL_SPELLWEAVING_STRENGTHEN]=8,
		[Talents.T_KAM_NATURAL_SPELLWEAVING_SUSTAIN]=8,
		[Talents.T_KAM_NATURAL_SPELLWEAVING_UNITY]=6,
		[Talents.T_KAM_SPELLWOVEN_ENHANCEMENTS_CORE]=7,
		[Talents.T_KAM_SPELLWOVEN_ENHANCEMENTS_COMBAT]=7,
		[Talents.T_KAM_SPELLWOVEN_ENHANCEMENTS_MOBILITY]=7,
		[Talents.T_KAM_SPELLWOVEN_ENHANCEMENTS_MASTERY]=10,
	},

	can_talk = "kam-spellweaver-professor-arbus",
}

newEntity{ define_as = "KAM_WOVENHOME_IRON",
	type = "humanoid", subtype = "dwarf",
	display = "i",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/humanoid_dwarf_dwarven_summoner.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Iron", color=colors.BROWN, unique = true,
desc = ([[A dwarf from a place far to the West called "Maj'Eyal". He and a few other dwarves apparently stranded himself here in a teleportation accident. Now he's studying Earth Spellwoven methods and teleportation to try to get back.
Although he's fairly new to Spellweaving, his skills are impressive, and his arrival from Maj'Eyal has already sparked new interest in Teleportation Spellweaving techniques, especially after Grath and the other Wovenhome orcs were able to provide more information about Maj'Eyal.]]):tformat(),
	level_range = {10, nil}, exp_worth = 2,
	rank = 2,
	size_category = 3,
	mana_regen = 4,
	max_mana = 200,
	max_life = 360, life_rating = 30, fixed_rating = true,
	infravision = 10,
	stats = { str=20, dex=10, cun=15, mag=22, con=20, wil=15 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	anger_emote = _t"Stone protect me!",
	hates_antimagic = 0,

	open_door = true,

	resolvers.inscriptions(1, "rune"),
	resolvers.inscriptions(1, {"manasurge rune"}),

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", subtype="staff", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", subtype="heavy", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_MOLTEN]=5,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=4,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=3,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=2,
		[Talents.T_KAM_SPELLWEAVER_CORE]=3,
		[Talents.T_KAM_SPELLWEAVER_POWER]=4,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=2,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=1,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=3,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=2,
	},
}

newEntity{ define_as = "KAM_WOVENHOME_GRATH",
	type = "humanoid", subtype = "orc",
	display = "g",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/humanoid_orc_orc_cryomancer.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Grath", color=colors.GREEN, unique = true,
desc = ([[The unofficial leader of the orcs who came to Wovenhome for safety. The Sunwall currently is not aware of this, which is probably for the best, considering the poor relations between the Spellweavers and them.
Grath was already experienced with the basics of Spellweaving before, and has now refined her skills in protective and mobility Spellweaving techniques. She also learned the basics of Kruk/Steam Giant tinker designs from some contacts, and some Spellweavers have started learning the techniques from her.
She was actually offered a role as a Professor focusing on protective Spellweaving and/or modern technological designs, but she turned it down.]]):tformat(),
	level_range = {30, nil}, exp_worth = 2,
	rank = 2,
	size_category = 3,
	mana_regen = 4,
	max_mana = 200,
	max_life = 360, life_rating = 30, fixed_rating = true,
	infravision = 10,
	stats = { str=12, dex=21, cun=34, mag=33, con=30, wil=43 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 20,
	hates_antimagic = 0,

	open_door = true,

	resolvers.inscriptions(2, {"manasurge rune"}),

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", subtype="staff", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", subtype="cloth", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_FIZZLE]=5,
		[Talents.T_KAM_SPELLWEAVER_WARP_PRECISION]=5,
		[Talents.T_KAM_SPELLWEAVER_TELEPORT_MASTERY]=3,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_DURATION]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_SPEED]=5,
		[Talents.T_KAM_SPELLWEAVER_SHIELDS_MASTERY]=3,
		[Talents.T_HEIGHTENED_SENSES]=5,
		[Talents.T_DEVICE_MASTERY]=5,
		[Talents.T_TRACK]=5,
		[Talents.T_DANGER_SENSE]=5,
	},
	
--	can_talk = "kam-spellweaver-wovenhome-grath",
}

newEntity{ define_as = "KAM_WOVENHOME_DYMION",
	type = "humanoid", subtype = "human",
	display = "d",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/humanoid_human_meranas__herald_of_angolwen.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Dymion", color=colors.YELLOW, unique = true,
desc = ([[Dymion is an enchanter, selling armor and weapons enchanted with Spellweaving techniques. Dymion supplies weapons to any Spellweaver and sells armor and protective items to most groups in Var'Eyal (which, although not terribly notable, include several groups of humans and elves living in odd parts of the coast or in the forests).
As for Dymion's Spellweaving focus, Dymion is decently experienced with normal Spellweaver casting techniques, but Dymion's specialty is channeling magic through and into weaponry, to enchant it and to empower melee attacks.]]):tformat(),
	level_range = {25, nil}, exp_worth = 2,
	rank = 3,
	size_category = 2,
	mana_regen = 20,
	max_mana = 400,
	max_life = 350, life_rating = 20, fixed_rating = true,
	infravision = 10,
	stats = { str=30, dex=15, cun=30, mag=30, con=20, wil=25 },
	instakill_immune = 1,
	teleport_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	hates_antimagic = 0,

	open_door = true,

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY]=3,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_STRENGTHEN]=2,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_SUSTAIN]=1,
		[Talents.T_KAM_ELEMENTS_OTHERWORLDLY_MASTERY]=1,
		[Talents.T_KAM_ELEMENTS_MOLTEN]=3,
		[Talents.T_KAM_ELEMENTS_MOLTEN_STRENGTHEN]=2,
		[Talents.T_KAM_ELEMENTS_MOLTEN_SUSTAIN]=1,
		[Talents.T_KAM_ELEMENTS_MOLTEN_MASTERY]=1,
		[Talents.T_KAM_ELEMENTS_ECLIPSE]=3,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_STRENGTHEN]=2,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_SUSTAIN]=1,
		[Talents.T_KAM_ELEMENTS_ECLIPSE_MASTERY]=1,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN]=3,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_STRENGTHEN]=2,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_SUSTAIN]=1,
		[Talents.T_KAM_ELEMENTS_WIND_AND_RAIN_MASTERY]=1,
		[Talents.T_KAM_ELEMENTS_RUIN]=3,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=2,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=1,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=1,
		[Talents.T_KAM_ELEMENTS_GRAVECHILL]=2,
		[Talents.T_KAM_ELEMENTS_GRAVITY]=2,
		[Talents.T_KAM_ELEMENTS_FEVER]=2,
		[Talents.T_KAM_ELEMENTS_MANASTORM]=2,
		[Talents.T_KAM_ELEMENTS_CORRODING_BRILLIANCE]=2,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=4,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=3,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=2,
		[Talents.T_KAM_ASC_CORE]=5,
		[Talents.T_KAM_ASC_EMPOWERMENT]=5,
		[Talents.T_KAM_ASC_RESONANCE]=5,
		[Talents.T_KAM_ASC_MASTERY]=5, -- If I get around to making Enchanters Dymion gets enchanter talents but I'm not even going to try to spoof those.
	},
	resolvers.store("KAM_WOVENHOME_STORE", "spellweavers"),
}

newEntity{ define_as = "KAM_WOVENHOME_FALLER",
	type = "undead", subtype = "skeleton",
	display = "f",
	resolvers.nice_tile{image="invis.png", add_mos = {{image="npc/undead_skeleton_skeleton_magus.png", display_h=1, display_y=0}}},
	faction = "spellweavers",
	name = "Faller", color=colors.ORCHID, unique = true,
desc = ([[A skeleton who apparently died many, many years ago, but who was only revived a few decades ago by Professor Hundredeyes. His focus is on Blight and how it can combine with other elements (apparently made easier by being a skeleton who cannot get sick).
He's kind of terrifying (what with the Blight and horrible cackling at odd hours), but he's actually known to be quite kind. He also often works as medical staff, since he is both immune to and very knowledgeable about diseases.
... although rumors still say he's forbidden from actually leaving Wovenhome.]]):tformat(),
	level_range = {40, nil}, exp_worth = 2,
	rank = 3,
	size_category = 2,
	mana_regen = 25,
	max_mana = 800,
	max_life = 300, life_rating = 8, fixed_rating = true,
	infravision = 10,
	stats = { str=8, dex=20, cun=50, mag=60, con=8, wil=20 },
	instakill_immune = 1,
	teleport_immune = 1,
	disease_immune = 1,
	move_others=true,
	combat_spellpower = 30,
	hates_antimagic = 0,

	open_door = true,

	body = { INVEN = 10, MAINHAND=1, OFFHAND=1, BODY=1 },

	resolvers.equip{
		{type="weapon", subtype="staff", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
		{type="armor", subtype="cloth", autoreq=true, forbid_power_source={antimagic=true}, tome_drops="store"},
	},

	resolvers.talents{
		[Talents.T_KAM_ELEMENTS_RUIN]=8,
		[Talents.T_KAM_ELEMENTS_RUIN_STRENGTHEN]=8,
		[Talents.T_KAM_ELEMENTS_RUIN_SUSTAIN]=8,
		[Talents.T_KAM_ELEMENTS_RUIN_MASTERY]=8,
		[Talents.T_KAM_ELEMENTS_FEVER]=5,
		[Talents.T_KAM_SPELLWEAVER_CORE]=5,
		[Talents.T_KAM_SPELLWEAVER_POWER]=5,
		[Talents.T_KAM_SPELLWEAVER_FINESSE]=5,
		[Talents.T_KAM_SPELLWEAVER_ADEPT]=3,
		[Talents.T_KAM_SPELLWOVEN_MASTERY]=5,
		[Talents.T_KAM_SPELLWOVEN_PERFECTION]=5,
		[Talents.T_KAM_SPELLWOVEN_DESTRUCTION]=5,
		[Talents.T_KAM_SPELLWEAVER_MASTER]=3,
		[Talents.T_KAM_BLIGHTWEAVER_COLD]=5,
		[Talents.T_KAM_FAKE_ELEMENT_BLIGHTWEAVER_COLD]=5,
		[Talents.T_KAM_BLIGHTWEAVER_ARCANE]=5,
		[Talents.T_KAM_FAKE_ELEMENT_BLIGHTWEAVER_ARCANE]=3,
	},
}